# RF24 Mesh Network
Этот проект реализует mesh-сеть из 5 узлов с использованием библиотеки RF24Mesh для обмена данными через радиомодули NRF24L01. Главный узел (устройство 1) периодически отправляет данные на все остальные узлы,
которые могут их перенаправлять дальше для гарантированной доставки в сеть. На каждом узле реализовано светодиодное оповещение об успешной отправке, а также о получении сообщения.


## Зависимости
Для работы кода необходимо установить следующие библиотеки:

- [RF24](https://github.com/nRF24/RF24): библиотека для работы с радиомодулями NRF24L01.
- [RF24Network](https://github.com/nRF24/RF24Network): надстройка для создания сети на основе радиомодулей NRF24L01.
- [RF24Mesh](https://github.com/nRF24/RF24Mesh): надстройка для автоматической конфигурации сети (mesh) на основе RF24Network.

Для установки библиотек:

1. Откройте Arduino IDE.
2. Перейдите в Sketch > Include Library > Manage Libraries.
3. Введите название библиотеки и установите ее.


## Схема подключения
![Схема подключения](/wiring_diagram.jpg "Схема подключения")


## Использование

### Описание проекта
В проекте участвуют 5 устройств, работающих в сети mesh. Каждое устройство имеет уникальный ID узла и выполняет свои функции в зависимости от роли:

- Устройство 1 (Главный узел):
  - Периодически отправляет данные на все узлы в сети.
  - Использует светодиод для сигнализации об успешной отправке (горит 200 мс) и о неуспешной (светодиод не загорается).
- Устройства 2-5 (Релейные узлы):
  - Получают сообщения, проверяют адрес назначения и перенаправляют их другим узлам при необходимости.
  - Используют светодиод для сигнализации при получении сообщения (горит 200 мс).
  - Каждый узел отправляет тестовое сообщение раз в секунду, если в сети нет других активных сообщений.
 
### Функции кода
1. **Отправка данных от главного узла (`sendMessages()`)**. Главный узел отправляет данные на все узлы сети, проверяя успешность передачи:
   ```
   bool success = network.write(header, &payload, sizeof(payload));
   ```
   Если передача успешна, светодиод на главном узле загорается на короткое время.

2. **Перенаправление сообщений (`forwardMessage(const payload_t &payload)`).** Узлы 2-5 получают данные, и если сообщение не предназначено для них, перенаправляют его дальше по сети:
   ```
   network.write(newHeader, &payload, sizeof(payload));
   ```

3. Сигнализация через светодиод:
   - При получении сообщения светодиод загорается на короткое время.
   - При успешной отправке светодиод загорается на 200 мс.
   - При неудачной отправке светодиод не загорается.

4. Обработка подключения: В случае потери связи с сетью узлы 2-5 пытаются обновить адрес и повторно подключиться.

### Начало работы
1. Настройка пинов и ID: В каждой программе необходимо правильно настроить CE и CSN для модуля NRF24L01, пин для светодиода, а также ID узла:
   ```
   RF24 radio(10, 9);  // CE и CSN пины
   const int ledPin = 2;  // Пин для светодиода
   const uint8_t nodeID = 2;  // Пример ID для устройства 2
   ```

2. Компиляция и загрузка кода:
   - Скопируйте и вставьте код для главного узла (устройства 1) и загрузите на одно из устройств.
   - Скопируйте и вставьте код для релейных узлов (устройства 2-5) и загрузите на остальные устройства, изменив `nodeID` на уникальный для каждого устройства (от 2 до 5).

3. Запуск и проверка:
   - После загрузки кода устройства будут автоматически подключаться к сети и обмениваться сообщениями.
   - Проверяйте успешность передачи данных по сигналам на светодиодах и выводу в Serial Monitor.
